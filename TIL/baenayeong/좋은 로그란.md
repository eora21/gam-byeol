## 좋은 로그란 무엇인가?

### 로그의 정의

로그란 이벤트에 대한 기록을 의미한다. 버그나 OS 레벨에서 시스템 이벤트를 추적하기 위해 남기는 **시스템 로그**와 우리가 운영하는 서비스에 대한 분석이나 유저의 CS에 대응하기 위해 남기는 **서비스 로그**로 나눌 수 있다.

로그에 포함될 각각의 데이터를 항목이라고 한다.

&nbsp;

### 좋은 로그란?

1. 필요한 정보가 있다.
2. 일관성이 있다.
3. 믿을 수 있다.

→ 말은 간단하지만 현실에서는 수많은 문제가 발생한다. 필요한 정보가 없거나, 의미를 추측하기 힘든 이름이거나 이름이 가지는 의미가 다른 콘텐츠의 이름과 충돌하는 경우, 값에 여러 데이터가 함께 포함되어 있어서 특정 데이터를 얻기 위해 매번 가공 처리를 해야 하기도 한다. 따라서 **로그 품질을 관리하려는 노력이 필요하다.**

&nbsp;

## 좋은 로그를 위해 고려해야 할 것들

### 로그에 필요한 정보를 저장하기 위해 고려할 점

1. 목표를 정의하자.

   목표를 먼저 한 문장으로 정의해보고 → ex. 재방문율 집계가 필요하다.

2. 하나의 지표에 대해서 다양한 각도로 고민해본다. → 추후 재방문율 집계시 국가별/레벨별/직업별 필터링이 필요할 것이다.

3. 목표에 따라 남겨야 할 이벤트와 그 항목들을 정의한다.

   목표가 있다면 우선순위를 파악할 수 있기 때문에 우선순위가 낮은 로그는 천천히 추가할 수도 있다.

&nbsp;

### 일관성

일관성은 같은 구성 요소에 대해서 같은 항목을 가지는 것이다.

- 일관성이 없는 사례

  ‘플레이어의 아이템 획득’ 로그와 ‘플레이어의 아이템 사용’ 로그가 있을 때, 두 이벤트 모두 플레이어에 대한 로그이지만 아이템 획득 로그에는 플레이어의 아이디, 직업, 레벨 항목들이 존재하는데 아이템 사용 로그에는 플레이어의 아이디와 직업 항목들만 있는 경우이다. 두 로그 모두 플레이어에 대한 로그인데 구성 항목이 다르므로 일관성이 없다. 두 로그 모두 플레이어에 대해 같은 구성의 항목을 가지고 있어야 일관성이 있다고 할 수 있다. 일관성을 더 높이기 위해서는 같은 의미의 항목에는 같은 이름을 사용하는 것이 좋다.

&nbsp;

### 믿을 수 있는 로그

1. 로그가 의도한 시점에서 잘 발생했을지 믿을 수 있는가?

   믿을 수 없는 경우는 버그로 인해 유실되었거나, 원래 설계와 다른 시점에서 로그가 발생하는 상황이 일어나는 경우 등이다.

2. 의도한 대로 데이터가 남았을까?

   의도한 것과 다른 데이터가 남을 수도 있다. 단순 실수로 인해 항목에 의도한 것과 다른 값이 들어가거나 유저의 어뷰징에 의해 로그가 변조되는 경우가 없어야 한다. 100%까지는 아니더라도 우리가 납득할 수 있는 수준까지의 노력은 필요하다.

   &nbsp;

## 의미가 명확한 로그를 위해 고려할 것들

### 이름을 잘 정하자

로그의 이벤트 이름 뿐만 아니라 항목에 대한 이름도 잘 정해야 한다. 나중에 이름을 바꾸면 큰 비용이 발생할 수도 있기 때문에 다소 길더라도 구체적인 이름을 사용해서 현재/미래의 다른 로그 이름의 의미와 헷갈릴 일을 줄이는 것이 좋다.

모두 일관화된 방식으로 이름을 짓기 위해 최소한의 규약을 정해둘 필요가 있다. 규약의 예시는 다음과 같다.

![image](https://user-images.githubusercontent.com/55578809/158606692-10e98e30-5e33-4ded-afbb-7f471d68356f.png)

&nbsp;

### 이벤트를 구별하는 기준

예시: 퀘스트의 시작, 퀘스트의 종료 vs. 이벤트 상태 업데이트

1. 이벤트의 시작, 이벤트의 종료 두 가지로 만드는 경우

   상태의 시작과 종류를 이벤트로 분류하는 구조로, 의미를 명확하게 구분할 수 있지만 이벤트 종류가 많아진다는 단점이 있다. 시작과 완료 시 항목 구성의 차이가 큰 경우에 적합하다.

2. 이벤트 상태 업데이트 한 가지로 만드는 경우

   로그 항목에서 상태 변화의 종류를 알 수 있는 구조로 같은 구성 요소에 대해서 상태만 변하는 경우, 항목 구성이 거의 비슷한 경우, 이력의 변화가 중요한 경우에 사용하기 적합하다.

→ 둘 중 절대적으로 좋은 것은 없다.

한 이벤트가 억지로 여러 가지 이벤트를 포괄하지 않도록 하는 것이 좋다.

&nbsp;

### 표현력

1. 축약된 표현을 사용하지 않는다. 이름을 조금 줄여도 데이터 저장 공간이 절약되지는 않는다.
2. 소수점 표현이나 숫자 표현에 따른 데이터 타입에 대한 고려가 필요하다.

&nbsp;

### 빈 값의 의미를 명확하게 한다.

빈 값은 해당 정보가 아예 존재하지 않는 경우 또는 값이 실제로 빈 값인 경우로 해석될 수 있는데 이렇게 여러가지 의미로 해석될 수 있는 건 좋지 않다. 빈 값을 무슨 의미로 둘 지도 명확히 정해놓는 것이 좋다.